<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Promise测试</title>
    <meta charset="utf-8" />
</head>
<body>
    <script>
        (function (window) {


            var noop = function () { };

           



            
            




            //var promise = new Promise(function (resolve, reject) {
            //    resolve('linkFly', '123');
            //});
            //console.group('promise测试');
            //promise.then(function () {
            //    console.log('应该输出linkFly', arguments, this);
            //}).then(function () {
            //    console.log('这里应该输出什么呢？', arguments,this);//输出了[undefined]
            //});
            //console.groupEnd();


            //console.group('promise测试2');
            //promise.then(function () {
            //    console.log('应该输出linkFly', arguments, this);
            //}).then(function () {
            //    return 1;
            //}).then(function () {
            //    console.log('第二次then', arguments, this);//arguments => [1],this => window Promise
            //});
            //console.groupEnd();


            //console.group('promise测试3');
            //promise.then(function () {
            //    return new Promise(function (resolve, reject) {
            //        setTimeout(function () {
            //            reject('error', '1');
            //        }, 1000);
            //    });
            //}).then(function () { }, function () {
            //    console.log('输出error?', arguments); //arguments => ["error"]
            //    return 1;
            //}).then(function () {
            //    console.log('第三次then - resolve', arguments); // => [1]
            //}, function () {
            //    console.log('第三次then - reject', arguments);
            //});
            //console.groupEnd();


            //console.group('promise测试4');
            //var promise = new Promise(function (resolve, reject) {
            //    resolve('linkFly', '123');
            //});
            //promise.then(function () {
            //    return new Promise(function (resolve, reject) {
            //        setTimeout(function () {
            //            resolve('OK');
            //        }, 1000);
            //    });
            //}).then(function () {
            //    console.log('这里应该输出什么呢？', arguments, this);//1s后输出了[OK]
            //});
            //console.groupEnd();



            //console.group('promise测试5');
            //promise.then(function () {
            //    return new Promise(function (resolve, reject) {
            //        setTimeout(function () {
            //            //throw new Error('再抛个异常');//这里抛的异常接不住
            //            reject('error', '1');
            //        }, 1000);
            //    });
            //})
            ////    .catch(function () {
            ////    console.log('catch：', arguments);
            ////})
            //    .then(function () { }, function () {
            //        console.log('输出error?', arguments); //arguments => ["error"]
            //        throw new Error('抛出异常');
            //    }).catch(function () {
            //        console.log('catch1:', arguments);//=> 如果这里catch1接住了异常，则后面不会传递
            //    }).then(function () {
            //        console.log('第三次then - resolve', arguments); // => [1]
            //    }, function (error) {
            //        console.log('第三次then - reject', error); //如果catch1没有接住异常，则error会传递到这里
            //    }).catch(function () {
            //        console.log('catch2:', arguments);
            //    });
            //console.groupEnd();



            //console.group('promise测试6');
            //var promise = new Promise(function (resolve, reject) {
            //    resolve('linkFly');
            //});
            //promise.then(function () {
            //    throw new Error('这里有异常');
            //})
            //.then(function () { }, function (e) {
            //    throw new Error('new Error');
            //})
            //.catch(function (e) {
            //    //console.log('catch捕获异常', e);
            //    return new Promise(function (resolve) {
            //        resolve('进入成功分支');
            //    })
            //}).then(function (data) {
            //    console.log('done', data);//进入成功分支
            //}, function (e) {
            //    console.log('catch Error:', e);//捕获
            //});
            //console.groupEnd();


            //console.group('promise测试7');
            //var promise = new Promise(function (resolve, reject) {
            //    //throw new Error('wtf?');
            //    resolve();
            //});
            //promise.then(function () {
            //    //Error冒泡
            //    throw new Error('Error');
            //})
            //.then(function () { })
            //.catch(function (e) {
            //    console.info('catch捕获异常', arguments); //=> Error: Error
            //    return new Promise(function (resolve) {
            //        resolve('进入成功分支');
            //    })
            //});
            //console.groupEnd();



            //console.group('promise测试8');
            //var promise = new Promise(function (resolve, reject) {
            //    throw new Error('wtf?');
            //});
            //promise.then(function () {
            //    //Error冒泡
            //    throw new Error('Error');

            //}, function () { })//去掉这个function就能捕捉到异常
            //.catch(function (e) {
            //    console.info('catch捕获异常', e); //=> wtf
            //    return new Promise(function (resolve) {
            //        resolve('进入成功分支');
            //    })
            //});
            //console.groupEnd();



            //console.group('Promise.all测试9');
            //var temp9 = new Promise(function (resolve) {
            //    setTimeout(function () {
            //        resolve('then');
            //    }, 1000);
            //}).then(function (data) {
            //    return new Promise(function (resolve) {
            //        setTimeout(function () {
            //            resolve(data);
            //        }, 3000);
            //    });
            //});

            //Promise.all([
            //     new Promise(function (resolve, reject) {
            //         setTimeout(function () {
            //             resolve(0);
            //         }, 200);
            //     }),
            //     new Promise(function (resolve, reject) {
            //         setTimeout(function () {
            //             reject(1);
            //         }, 300);
            //     })
            //]).then(function (data) {
            //    console.log('进入done分支，具有Promise的行为的参数会等待Promise处理完毕', data);
            //}, function (data) {
            //    console.log('不应该进入fail分支', data);
            //});

            //Promise.all([
            //    true,
            //    false,
            //    new Promise(function (resolve, reject) {
            //        setTimeout(function () {
            //            resolve(0);
            //            //reject(1);
            //        }, 1000);
            //    }),
            //    {
            //        //含有then的对象包装
            //        then: function (resolve, reject) {
            //            setTimeout(function () {
            //                resolve(1);
            //                //reject(1); //=>直接进入fail
            //            }, 2000);
            //        }
            //    },
            //    function () {
            //        console.log(2);
            //    },
            //    temp9,
            //    { 'name': 'linkFly' }]

            //    ).then(function (data) {
            //        console.log('done', data);//=>[ true, false, 0, 1, function, 'then', {name:'linkFly'} ]
            //    }, function () {
            //        console.log('fail', arguments);
            //    });
            //console.groupEnd();



            //console.group('Promise.resolve测试10');
            //var temp10 = new Promise(function (resolve) {
            //    setTimeout(function () {
            //        resolve('then');
            //    }, 1000);
            //}).then(function (data) {
            //    return new Promise(function (resolve) {
            //        setTimeout(function () {
            //            resolve(data);
            //        }, 3000);
            //    });
            //});
            //Promise.resolve(temp10).then(function (data) {
            //    console.log('done', data);//=> 4s => then
            //}, function () {
            //    console.log('fail', arguments);
            //});
            //console.groupEnd();


            //console.group('Promise.resolve测试11');
            //Promise.resolve({
            //    then: function (resolve, reject) {
            //        setTimeout(function () {
            //            resolve(0);
            //            //reject(0);//进入fail
            //        }, 1000);
            //    }
            //}).then(function (data) {
            //    console.log('done', data);//=> 1s => 0
            //}, function () {
            //    console.log('fail', arguments);
            //});
            //console.groupEnd();


            //console.group('Promise.resolve测试12');
            //Promise.resolve({
            //    then: function (resolve, reject) {
            //        setTimeout(function () {
            //            resolve(0);
            //            //reject(0);//进入fail
            //        }, 1000);
            //    }
            //}).then(function (data) {
            //    console.log('done', data);//=> 1s => 0
            //}, function () {
            //    console.log('fail', arguments);
            //});
            //console.groupEnd();



            //Promise.race([true]).then(function (data) {
            //    console.log('done', data);
            //}, function (data) {
            //    console.log('fail', data);
            //});

            //console.group('Promise.race测试13');
            //Promise.race([{
            //    then: function (resolve) {
            //        setTimeout(function () {
            //            resolve('0');
            //        }, 100);
            //    }
            //},
            //new Promise(function (resolve, reject) {
            //    setTimeout(function () {
            //        reject('1');
            //    }, 200);
            //}),

            ////0,

            ////true,

            //function (name) { }
            //]).then(function (data) {
            //    console.log('done', data);
            //}, function (data) {
            //    console.log('fail', data);
            //});



            //console.group('Promise.resolve测试14');
            //var temp14 = new Promise(function (resolve, reject) {
            //    setTimeout(function () {
            //        reject('123');
            //    });
            //}).then(function (data) {

            //}, function (data) {
            //    return new Promise(function (resolve, reject) {
            //        setTimeout(function () {
            //            reject(data);
            //        }, 3000);
            //    });
            //});

            ////Promise.reject({
            ////    then: function (resolve, reject) {
            ////        setTimeout(function () {
            ////            reject(0);
            ////            //reject(0);//进入fail
            ////        }, 1000);
            ////    }
            ////}).then(function (data) {
            ////    console.log('done', data);
            ////}, function (data) {
            ////    console.log('fail', data);//木有包装
            ////});

            //Promise.reject(new Promise(function (resolve, reject) {
            //    setTimeout(function () {
            //        reject(0);
            //    }, 1000);
            //})).then(function (data) {
            //    console.log('done', data);
            //}, function (data) {
            //    console.log('fail', data);
            //});

            //Promise.reject(temp14).then(function (data) {
            //    console.log('done', data);
            //}, function (data) {
            //    console.log('fail', data);//也没有包装
            //});
            //console.groupEnd();


            //console.group('Promise.resolve测试15');
            //new Promise(function (resolve, reject) {
            //    setTimeout(function () {
            //        reject('123');
            //    });
            //});

            //new Promise(function (resolve, reject) {
            //    setTimeout(function () {
            //        throw new Error('abc');
            //    }, 1000);
            //})
            //.catch(function (data) {
            //    console.log(data);
            //});

            //.then(function () {

            //}, function (data) {
            //    console.log(data);
            //});


            //new Promise(function (resolve, reject) {
            //    setTimeout(function () {
            //        throw new Error('linkFly');
            //        //resolve('linkFly');

            //    }, 1000);
            //}).then(function (data) {
            //    throw new Error(data);
            //}).then(function () { }).catch(function (data) {
            //    console.log('fail', data);
            //});



            //console.group('Promise 异常跑到catch');
            //new Promise(function (resolve) {
            //    setTimeout(function () {
            //        resolve(0);
            //    });
            //}).then(function (data) {
            //    console.log('done', 1);
            //    throw new Error(2);
            //}, function (e) {
            //    console.log('error', e);
            //})
            //.then(function () { }, function (e) {
            //    console.log('error2', e);
            //});
            //console.groupEnd();


            //console.group('Promise executor回调timeout抛出异常');
            //new Promise(function (resolve, reject) {
            //    setTimeout(function () {
            //        throw new Error('123');//这个异常捕获不到
            //    }, 1000);
            //}).catch(function (e) {
            //    console.log('成功捕获异常：' + e);
            //});
        })(window);

    </script>
</body>
</html>
